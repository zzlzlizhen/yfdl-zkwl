<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.remote.modules.sys.dao.FeedbackDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.remote.modules.sys.entity.FeedbackEntity" id="feedbackMap">
        <result property="backId" column="back_id"/>
        <result property="uid" column="uid"/>
        <result property="backContent" column="back_content"/>
        <result property="backCreateTime" column="back_create_time"/>
        <result property="answerContent" column="answer_content"/>
        <result property="answerUser" column="answer_user"/>
        <result property="answerCreateTime" column="answer_create_time"/>
        <result property="mobile" column="mobile"/>
        <result property="email" column="email"/>
        <result property="title" column="title"/>
        <result property="isRead" column="is_read"/>
    </resultMap>
    <sql id="columns" >
        a.back_id as backId,
        a.uid as uid,
        a.back_content as backContent,
        a.back_create_time as backCreateTime,
        a.answer_content as answerContent,
        a.answer_user as answerUser,
        a.answer_create_time as answerCreateTime,
        a.mobile as mobile,
        a.email as email,
        a.title as title,
        a.is_read as isRead
    </sql>
    <!-- 查询用户的所有下级用户的反馈列表 -->
    <select id="queryBackList" resultType="com.remote.modules.sys.entity.FeedbackEntity">
       SELECT <include refid="columns"/> FROM feedback
        WHERE a.uid in
        <foreach collection="userIds" index="index"
                 item="uid" open="(" separator="," close=")">
           #{uid}
        </foreach>
    </select>
    <select id="queryPageCount" resultType="java.lang.Integer">
        select count(back_id) from feedback where uid in
        <foreach collection="userIds" index="index"
             item="uid" open="(" separator="," close=")">
        #{uid}
    </foreach>
    </select>

    <select id="queryPageList"  resultType="com.remote.modules.sys.entity.FeedbackEntity">
      SELECT <include refid="columns"/>,b.head_url as headUrl, b.username as username FROM feedback a LEFT JOIN sys_user b ON a.uid=b.user_id
        left join msg_back_readed m on m.uid in
        <foreach collection="userIds" index="index"
           item="uid" open="(" separator="," close=")">
        #{uid}
    </foreach>
       WHERE m. msg_back_id = a.back_id and b.user_id  IN
        <foreach collection="userIds" index="index"
                 item="uid" open="(" separator="," close=")">
        #{uid}
    </foreach>
     LIMIT #{offset},#{limit}
    </select>
</mapper>

